{"ast":null,"code":"import _toConsumableArray from\"D:/programming/ToDoListDimych/todolist/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _defineProperty from\"D:/programming/ToDoListDimych/todolist/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"D:/programming/ToDoListDimych/todolist/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import{todolistsAPI}from'../../api/todolists-api';import{setAppStatusAC}from'../../app/app-reducer';import{handleServerAppError,handleServerNetworkError}from'../../utils/error-utils';var initialState={};export var tasksReducer=function tasksReducer(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:initialState;var action=arguments.length>1?arguments[1]:undefined;switch(action.type){case'REMOVE-TASK':return _objectSpread(_objectSpread({},state),{},_defineProperty({},action.todolistId,state[action.todolistId].filter(function(t){return t.id!=action.taskId;})));case'ADD-TASK':return _objectSpread(_objectSpread({},state),{},_defineProperty({},action.task.todoListId,[action.task].concat(_toConsumableArray(state[action.task.todoListId]))));case'UPDATE-TASK':return _objectSpread(_objectSpread({},state),{},_defineProperty({},action.todolistId,state[action.todolistId].map(function(t){return t.id===action.taskId?_objectSpread(_objectSpread({},t),action.model):t;})));case'ADD-TODOLIST':return _objectSpread(_objectSpread({},state),{},_defineProperty({},action.todolist.id,[]));case'REMOVE-TODOLIST':var copyState=_objectSpread({},state);delete copyState[action.id];return copyState;case'SET-TODOLISTS':{var _copyState=_objectSpread({},state);action.todolists.forEach(function(tl){_copyState[tl.id]=[];});return _copyState;}case'SET-TASKS':return _objectSpread(_objectSpread({},state),{},_defineProperty({},action.todolistId,action.tasks));default:return state;}};// actions\nexport var removeTaskAC=function removeTaskAC(taskId,todolistId){return{type:'REMOVE-TASK',taskId:taskId,todolistId:todolistId};};export var addTaskAC=function addTaskAC(task){return{type:'ADD-TASK',task:task};};export var updateTaskAC=function updateTaskAC(taskId,model,todolistId){return{type:'UPDATE-TASK',model:model,todolistId:todolistId,taskId:taskId};};export var setTasksAC=function setTasksAC(tasks,todolistId){return{type:'SET-TASKS',tasks:tasks,todolistId:todolistId};};// thunks\nexport var fetchTasksTC=function fetchTasksTC(todolistId){return function(dispatch){dispatch(setAppStatusAC('loading'));todolistsAPI.getTasks(todolistId).then(function(res){var tasks=res.data.items;dispatch(setTasksAC(tasks,todolistId));dispatch(setAppStatusAC('succeeded'));});};};export var removeTaskTC=function removeTaskTC(taskId,todolistId){return function(dispatch){todolistsAPI.deleteTask(todolistId,taskId).then(function(res){var action=removeTaskAC(taskId,todolistId);dispatch(action);});};};export var addTaskTC=function addTaskTC(title,todolistId){return function(dispatch){dispatch(setAppStatusAC('loading'));todolistsAPI.createTask(todolistId,title).then(function(res){if(res.data.resultCode===0){var task=res.data.data.item;var action=addTaskAC(task);dispatch(action);dispatch(setAppStatusAC('succeeded'));}else{handleServerAppError(res.data,dispatch);}}).catch(function(error){handleServerNetworkError(error,dispatch);});};};export var updateTaskTC=function updateTaskTC(taskId,domainModel,todolistId){return function(dispatch,getState){var state=getState();var task=state.tasks[todolistId].find(function(t){return t.id===taskId;});if(!task){//throw new Error(\"task not found in the state\");\nconsole.warn('task not found in the state');return;}var apiModel=_objectSpread({deadline:task.deadline,description:task.description,priority:task.priority,startDate:task.startDate,title:task.title,status:task.status},domainModel);todolistsAPI.updateTask(todolistId,taskId,apiModel).then(function(res){if(res.data.resultCode===0){var action=updateTaskAC(taskId,domainModel,todolistId);dispatch(action);}else{handleServerAppError(res.data,dispatch);}}).catch(function(error){handleServerNetworkError(error,dispatch);});};};// types","map":{"version":3,"sources":["D:/programming/ToDoListDimych/todolist/src/features/TodolistsList/tasks-reducer.ts"],"names":["todolistsAPI","setAppStatusAC","handleServerAppError","handleServerNetworkError","initialState","tasksReducer","state","action","type","todolistId","filter","t","id","taskId","task","todoListId","map","model","todolist","copyState","todolists","forEach","tl","tasks","removeTaskAC","addTaskAC","updateTaskAC","setTasksAC","fetchTasksTC","dispatch","getTasks","then","res","data","items","removeTaskTC","deleteTask","addTaskTC","title","createTask","resultCode","item","catch","error","updateTaskTC","domainModel","getState","find","console","warn","apiModel","deadline","description","priority","startDate","status","updateTask"],"mappings":"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","sourcesContent":["import {AddTodolistActionType, RemoveTodolistActionType, SetTodolistsActionType} from './todolists-reducer'\r\nimport {TaskPriorities, TaskStatuses, TaskType, todolistsAPI, UpdateTaskModelType} from '../../api/todolists-api'\r\nimport {Dispatch} from 'redux'\r\nimport {AppRootStateType} from '../../app/store'\r\nimport {setAppErrorAC, SetAppErrorActionType, setAppStatusAC, SetAppStatusActionType} from '../../app/app-reducer'\r\nimport {handleServerAppError, handleServerNetworkError} from '../../utils/error-utils'\r\n\r\nconst initialState: TasksStateType = {}\r\n\r\nexport const tasksReducer = (state: TasksStateType = initialState, action: ActionsType): TasksStateType => {\r\n    switch (action.type) {\r\n        case 'REMOVE-TASK':\r\n            return {...state, [action.todolistId]: state[action.todolistId].filter(t => t.id != action.taskId)}\r\n        case 'ADD-TASK':\r\n            return {...state, [action.task.todoListId]: [action.task, ...state[action.task.todoListId]]}\r\n        case 'UPDATE-TASK':\r\n            return {\r\n                ...state,\r\n                [action.todolistId]: state[action.todolistId]\r\n                    .map(t => t.id === action.taskId ? {...t, ...action.model} : t)\r\n            }\r\n        case 'ADD-TODOLIST':\r\n            return {...state, [action.todolist.id]: []}\r\n        case 'REMOVE-TODOLIST':\r\n            const copyState = {...state}\r\n            delete copyState[action.id]\r\n            return copyState\r\n        case 'SET-TODOLISTS': {\r\n            const copyState = {...state}\r\n            action.todolists.forEach(tl => {\r\n                copyState[tl.id] = []\r\n            })\r\n            return copyState\r\n        }\r\n        case 'SET-TASKS':\r\n            return {...state, [action.todolistId]: action.tasks}\r\n        default:\r\n            return state\r\n    }\r\n}\r\n\r\n// actions\r\nexport const removeTaskAC = (taskId: string, todolistId: string) =>\r\n    ({type: 'REMOVE-TASK', taskId, todolistId} as const)\r\nexport const addTaskAC = (task: TaskType) =>\r\n    ({type: 'ADD-TASK', task} as const)\r\nexport const updateTaskAC = (taskId: string, model: UpdateDomainTaskModelType, todolistId: string) =>\r\n    ({type: 'UPDATE-TASK', model, todolistId, taskId} as const)\r\nexport const setTasksAC = (tasks: Array<TaskType>, todolistId: string) =>\r\n    ({type: 'SET-TASKS', tasks, todolistId} as const)\r\n\r\n// thunks\r\nexport const fetchTasksTC = (todolistId: string) => (dispatch: Dispatch<ActionsType | SetAppStatusActionType>) => {\r\n    dispatch(setAppStatusAC('loading'))\r\n    todolistsAPI.getTasks(todolistId)\r\n        .then((res) => {\r\n            const tasks = res.data.items\r\n            dispatch(setTasksAC(tasks, todolistId))\r\n            dispatch(setAppStatusAC('succeeded'))\r\n        })\r\n}\r\nexport const removeTaskTC = (taskId: string, todolistId: string) => (dispatch: Dispatch<ActionsType>) => {\r\n    todolistsAPI.deleteTask(todolistId, taskId)\r\n        .then(res => {\r\n            const action = removeTaskAC(taskId, todolistId)\r\n            dispatch(action)\r\n        })\r\n}\r\nexport const addTaskTC = (title: string, todolistId: string) => (dispatch: Dispatch<ActionsType | SetAppErrorActionType | SetAppStatusActionType>) => {\r\n    dispatch(setAppStatusAC('loading'))\r\n    todolistsAPI.createTask(todolistId, title)\r\n        .then(res => {\r\n            if (res.data.resultCode === 0) {\r\n                const task = res.data.data.item\r\n                const action = addTaskAC(task)\r\n                dispatch(action)\r\n                dispatch(setAppStatusAC('succeeded'))\r\n            } else {\r\n                handleServerAppError(res.data, dispatch);\r\n            }\r\n        })\r\n        .catch((error) => {\r\n            handleServerNetworkError(error, dispatch)\r\n        })\r\n}\r\nexport const updateTaskTC = (taskId: string, domainModel: UpdateDomainTaskModelType, todolistId: string) =>\r\n    (dispatch: ThunkDispatch, getState: () => AppRootStateType) => {\r\n        const state = getState()\r\n        const task = state.tasks[todolistId].find(t => t.id === taskId)\r\n        if (!task) {\r\n            //throw new Error(\"task not found in the state\");\r\n            console.warn('task not found in the state')\r\n            return\r\n        }\r\n\r\n        const apiModel: UpdateTaskModelType = {\r\n            deadline: task.deadline,\r\n            description: task.description,\r\n            priority: task.priority,\r\n            startDate: task.startDate,\r\n            title: task.title,\r\n            status: task.status,\r\n            ...domainModel\r\n        }\r\n\r\n        todolistsAPI.updateTask(todolistId, taskId, apiModel)\r\n            .then(res => {\r\n                if (res.data.resultCode === 0) {\r\n                    const action = updateTaskAC(taskId, domainModel, todolistId)\r\n                    dispatch(action)\r\n                } else {\r\n                    handleServerAppError(res.data, dispatch);\r\n                }\r\n            })\r\n            .catch((error) => {\r\n                handleServerNetworkError(error, dispatch);\r\n            })\r\n    }\r\n\r\n// types\r\nexport type UpdateDomainTaskModelType = {\r\n    title?: string\r\n    description?: string\r\n    status?: TaskStatuses\r\n    priority?: TaskPriorities\r\n    startDate?: string\r\n    deadline?: string\r\n}\r\nexport type TasksStateType = {\r\n    [key: string]: Array<TaskType>\r\n}\r\ntype ActionsType =\r\n    | ReturnType<typeof removeTaskAC>\r\n    | ReturnType<typeof addTaskAC>\r\n    | ReturnType<typeof updateTaskAC>\r\n    | AddTodolistActionType\r\n    | RemoveTodolistActionType\r\n    | SetTodolistsActionType\r\n    | ReturnType<typeof setTasksAC>\r\ntype ThunkDispatch = Dispatch<ActionsType | SetAppStatusActionType | SetAppErrorActionType>\r\n"]},"metadata":{},"sourceType":"module"}